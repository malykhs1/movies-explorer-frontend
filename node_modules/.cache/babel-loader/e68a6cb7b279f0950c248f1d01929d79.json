{"ast":null,"code":"import _asyncToGenerator from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from\"react\";import{Header}from\"../Header/Header\";import{SearchForm}from\"../SearchForm/SearchForm\";import{Navigation}from\"../Navigation/Navigation\";import{MoviesCardList}from\"../MoviesCardList/MoviesCadList\";import{Footer}from\"../Footer/Footer\";import{apiFilm}from\"../../utils/MoviesApi\";import{api}from\"../../utils/api\";import{Preloader}from\"../Preloader/Loader\";import{InfoToolTip}from\"../Popup/Popup\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Movies=function Movies(){var imageURL='https://api.nomoreparties.co';//all films from server\nvar _useState=useState(null),_useState2=_slicedToArray(_useState,2),films=_useState2[0],setFilms=_useState2[1];//фильмы, которые мы будем отображать!\nvar _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),filmsShowed=_useState4[0],setFilmsShowed=_useState4[1];//залайканные фильмы\nvar _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),filmsSaved=_useState6[0],setFilmsSaved=_useState6[1];//устанавливаем кол-вол карточек для отображения\nvar _useState7=useState(10),_useState8=_slicedToArray(_useState7,2),visible=_useState8[0],setVisible=_useState8[1];//прелоадер\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),preloader=_useState10[0],setPreloader=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),filmsTumbler=_useState12[0],setFilmsTumbler=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),filmsInputSearch=_useState14[0],setFilmsInputSearch=_useState14[1];var _useState15=useState(true),_useState16=_slicedToArray(_useState15,2),isSuccseed=_useState16[0],setSuccseed=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isInfoToolTipOpened=_useState18[0],setIsInfoToolTipOpened=_useState18[1];var closeAllPopups=function closeAllPopups(){setIsInfoToolTipOpened(false);};function handleGetMovies(_x,_x2){return _handleGetMovies.apply(this,arguments);}function _handleGetMovies(){_handleGetMovies=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(inputSearch,tumbler){var token,data,filterData,shortFilms,spliceData,_spliceData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// localStorage.setItem('filmsTumbler', false);\nsetPreloader(true);_context.prev=1;token=localStorage.getItem('token');_context.next=5;return apiFilm.getFilmInfo(token);case 5:data=_context.sent;filterData=data.filter(function(_ref){var nameRU=_ref.nameRU;return nameRU.toLowerCase().includes(inputSearch.toLowerCase());});if(tumbler===true){localStorage.setItem('films',JSON.stringify(filterData));localStorage.setItem('filmsInputSearch',inputSearch);shortFilms=filterData.filter(function(_ref2){var duration=_ref2.duration;return duration<=40;});setFilmsShowed(shortFilms);spliceData=shortFilms.splice(0,visible);localStorage.setItem('savedResults',JSON.stringify(spliceData));setFilmsShowed(spliceData);setFilms(spliceData);}else{localStorage.setItem('films',JSON.stringify(filterData));localStorage.setItem('filmsInputSearch',inputSearch);_spliceData=filterData.splice(0,visible);localStorage.setItem('savedResults',JSON.stringify(_spliceData));setFilmsShowed(_spliceData);setFilms(filterData);}_context.next=16;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);setFilms([]);localStorage.removeItem('films');localStorage.removeItem('filmsTumbler');localStorage.removeItem('filmsInputSearch');case 16:_context.prev=16;setPreloader(false);return _context.finish(16);case 19:case\"end\":return _context.stop();}}},_callee,null,[[1,10,16,19]]);}));return _handleGetMovies.apply(this,arguments);}function handleGetMoviesTumbler(_x3,_x4){return _handleGetMoviesTumbler.apply(this,arguments);}// добавляем количество фильмов при нажатии на кнопку\nfunction _handleGetMoviesTumbler(){_handleGetMoviesTumbler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(keyword,tumbler){var filterDataShowed,filterData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:filterDataShowed=[];filterData=[];handleGetMovies(keyword,tumbler);localStorage.setItem('films',JSON.stringify(filterDataShowed.concat(filterData)));localStorage.setItem('filmsTumbler',tumbler);setFilmsShowed(filterDataShowed);setFilms(filterData);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return _handleGetMoviesTumbler.apply(this,arguments);}var handleMore=function handleMore(){var newFilmsShowed=filmsShowed.concat(films.splice(0,visible));setFilmsShowed(newFilmsShowed);};function savedMoviesToggle(_x5,_x6){return _savedMoviesToggle.apply(this,arguments);}//монтируем \nfunction _savedMoviesToggle(){_savedMoviesToggle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(movie,fav){var token,savedMovie,newSaved,_token,_newSaved;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!fav){_context3.next=19;break;}token=localStorage.getItem('token');savedMovie={country:movie.country||'none',director:movie.director||'none',duration:movie.duration,year:movie.year,description:movie.description||'none',nameRU:movie.nameRU,nameEN:movie.nameEN,image:\"\".concat(imageURL).concat(movie.image.url)||'https://www.youtube.com/',trailer:movie.trailerLink||'https://www.youtube.com',thumbnail:\"\".concat(imageURL).concat(movie.image.url)||'https://www.youtube.com/',movieId:movie.id};_context3.prev=3;_context3.next=6;return api.addNewCard(savedMovie,token);case 6:_context3.next=8;return api.getLikeMovies(token);case 8:newSaved=_context3.sent;setFilmsSaved(newSaved);_context3.next=17;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](3);setSuccseed(false);setIsInfoToolTipOpened(true);console.log(_context3.t0);case 17:_context3.next=34;break;case 19:_context3.prev=19;_token=localStorage.getItem('token');_context3.next=23;return api.removeNewCard(movie._id,_token);case 23:_context3.next=25;return api.getLikeMovies(_token);case 25:_newSaved=_context3.sent;setFilmsSaved(_newSaved);_context3.next=34;break;case 29:_context3.prev=29;_context3.t1=_context3[\"catch\"](19);setSuccseed(false);setIsInfoToolTipOpened(true);console.log(_context3.t1);case 34:case\"end\":return _context3.stop();}}},_callee3,null,[[3,12],[19,29]]);}));return _savedMoviesToggle.apply(this,arguments);}useEffect(function(){//фильмы с сервака\nvar token=localStorage.getItem('token');api.getLikeMovies(token).then(function(data){setFilmsSaved(data);}).catch(function(err){return console.log(err);});var localStorageSaveFilms=localStorage.getItem('savedResults');var localStorageFilms=localStorage.getItem('films');if(localStorageSaveFilms){var filterData=JSON.parse(localStorageSaveFilms);var allFindFilms=JSON.parse(localStorageFilms);console.log(filterData);setFilmsShowed(filterData);setFilms(allFindFilms.splice(10));setPreloader(false);}var localStorageFilmsInputSearch=localStorage.getItem('filmsInputSearch');var localStorageFilmsTumbler=localStorage.getItem('filmsTumbler');if(localStorageFilmsTumbler){setFilmsTumbler(localStorageFilmsTumbler==='true');}if(localStorageFilmsInputSearch){setFilmsInputSearch(localStorageFilmsInputSearch);}},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(Navigation,{}),/*#__PURE__*/_jsx(SearchForm,{handleGetMovies:handleGetMovies,filmsTumbler:filmsTumbler,filmsInputSearch:filmsInputSearch,handleGetMoviesTumbler:handleGetMoviesTumbler}),preloader&&/*#__PURE__*/_jsx(Preloader,{}),!preloader&&films!==null&&filmsSaved!==null&&filmsShowed!==null&&/*#__PURE__*/_jsx(MoviesCardList,{handleMore:handleMore,filmsRemains:films,films:filmsShowed,savedMoviesToggle:savedMoviesToggle,filmsSaved:filmsSaved}),/*#__PURE__*/_jsx(Footer,{}),/*#__PURE__*/_jsx(InfoToolTip,{id:\"reg-pic\",isOpened:isInfoToolTipOpened,onClose:closeAllPopups,isSuccseed:isSuccseed})]});};","map":{"version":3,"sources":["/Users/aleksandrmalyh/dev/movies-explorer-frontend/src/components/Movies/Movies.js"],"names":["React","useEffect","useState","Header","SearchForm","Navigation","MoviesCardList","Footer","apiFilm","api","Preloader","InfoToolTip","Movies","imageURL","films","setFilms","filmsShowed","setFilmsShowed","filmsSaved","setFilmsSaved","visible","setVisible","preloader","setPreloader","filmsTumbler","setFilmsTumbler","filmsInputSearch","setFilmsInputSearch","isSuccseed","setSuccseed","isInfoToolTipOpened","setIsInfoToolTipOpened","closeAllPopups","handleGetMovies","inputSearch","tumbler","token","localStorage","getItem","getFilmInfo","data","filterData","filter","nameRU","toLowerCase","includes","setItem","JSON","stringify","shortFilms","duration","spliceData","splice","removeItem","handleGetMoviesTumbler","keyword","filterDataShowed","concat","handleMore","newFilmsShowed","savedMoviesToggle","movie","fav","savedMovie","country","director","year","description","nameEN","image","url","trailer","trailerLink","thumbnail","movieId","id","addNewCard","getLikeMovies","newSaved","console","log","removeNewCard","_id","then","catch","err","localStorageSaveFilms","localStorageFilms","parse","allFindFilms","localStorageFilmsInputSearch","localStorageFilmsTumbler"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Header } from \"../Header/Header\";\nimport { SearchForm } from \"../SearchForm/SearchForm\";\nimport { Navigation } from \"../Navigation/Navigation\";\nimport { MoviesCardList } from \"../MoviesCardList/MoviesCadList\";\nimport { Footer } from \"../Footer/Footer\";\nimport { apiFilm } from \"../../utils/MoviesApi\";\nimport { api } from \"../../utils/api\";\nimport { Preloader } from \"../Preloader/Loader\";\nimport { InfoToolTip } from \"../Popup/Popup\";\n\n\nexport const Movies = () => {\n\n  const imageURL = 'https://api.nomoreparties.co';\n\n  //all films from server\n  const [films, setFilms] = useState(null)\n  //фильмы, которые мы будем отображать!\n  const [filmsShowed, setFilmsShowed] = useState(null);\n  //залайканные фильмы\n  const [filmsSaved, setFilmsSaved] = useState(null);\n\n  //устанавливаем кол-вол карточек для отображения\n  const [visible, setVisible] = useState(10);\n\n  //прелоадер\n  const [preloader, setPreloader] = useState(false);\n\n\n  const [filmsTumbler, setFilmsTumbler] = useState(false);\n  const [filmsInputSearch, setFilmsInputSearch] = useState('');\n\n  const [isSuccseed, setSuccseed] = useState(true);\n  const [isInfoToolTipOpened, setIsInfoToolTipOpened] = useState(false);\n\n  const closeAllPopups = () => {\n    setIsInfoToolTipOpened(false);\n  };\n\n  async function handleGetMovies(inputSearch, tumbler) {\n    // localStorage.setItem('filmsTumbler', false);\n    setPreloader(true);\n    try {\n      const token = localStorage.getItem('token')\n      const data = await apiFilm.getFilmInfo(token);\n      let filterData = data.filter(({ nameRU }) => nameRU.toLowerCase().includes(inputSearch.toLowerCase()));\n      if (tumbler === true) {\n        localStorage.setItem('films', JSON.stringify(filterData)); \n        localStorage.setItem('filmsInputSearch', inputSearch); \n        const shortFilms = filterData.filter(({ duration }) => duration <= 40);\n        setFilmsShowed(shortFilms);\n        const spliceData = shortFilms.splice(0, visible);\n        localStorage.setItem('savedResults',JSON.stringify(spliceData)); \n        setFilmsShowed(spliceData);\n        setFilms(spliceData);\n       \n      }\n      else {\n        localStorage.setItem('films', JSON.stringify(filterData)); \n        localStorage.setItem('filmsInputSearch', inputSearch);\n        const spliceData = filterData.splice(0, visible);\n        localStorage.setItem('savedResults',JSON.stringify(spliceData)); \n        setFilmsShowed(spliceData);\n        setFilms(filterData);\n\n      }\n    } catch (err) {\n      setFilms([]);\n      localStorage.removeItem('films');\n      localStorage.removeItem('filmsTumbler');\n      localStorage.removeItem('filmsInputSearch');\n    } finally {\n      setPreloader(false)\n    }\n  }\n\n\n  async function handleGetMoviesTumbler(keyword, tumbler) {\n    let filterDataShowed = [];\n    let filterData = [];\n   \n    handleGetMovies(keyword, tumbler)\n\n    localStorage.setItem('films', JSON.stringify(filterDataShowed.concat(filterData)));\n    localStorage.setItem('filmsTumbler', tumbler); \n\n    setFilmsShowed(filterDataShowed);\n    setFilms(filterData)\n  }\n\n  // добавляем количество фильмов при нажатии на кнопку\n  const handleMore = () => {\n    const newFilmsShowed = filmsShowed.concat(films.splice(0, visible));\n    setFilmsShowed(newFilmsShowed);\n  }\n\n  async function savedMoviesToggle(movie, fav) {\n    if (fav) {\n      const token = localStorage.getItem('token')\n      const savedMovie = {\n        country: movie.country || 'none',\n        director: movie.director || 'none',\n        duration: movie.duration,\n        year: movie.year,\n        description: movie.description || 'none',\n        nameRU: movie.nameRU,\n        nameEN: movie.nameEN,\n        image: `${imageURL}${movie.image.url}` || 'https://www.youtube.com/',\n        trailer: movie.trailerLink || 'https://www.youtube.com',\n        thumbnail: `${imageURL}${movie.image.url}` || 'https://www.youtube.com/',\n        movieId: movie.id,\n      }\n      try {\n        await api.addNewCard(savedMovie, token);\n        const newSaved = await api.getLikeMovies(token);\n        setFilmsSaved(newSaved);\n      } catch (error) {\n        setSuccseed(false)\n                setIsInfoToolTipOpened(true);\n                console.log(error);\n      }\n    } else {\n      try {\n        const token = localStorage.getItem('token')\n        await api.removeNewCard(movie._id, token);\n        const newSaved = await api.getLikeMovies(token);\n        setFilmsSaved(newSaved);\n      } catch (error) {\n        setSuccseed(false)\n        setIsInfoToolTipOpened(true);\n        console.log(error);      }\n    }\n  }\n\n  //монтируем \n  useEffect(() => {\n    //фильмы с сервака\n    const token = localStorage.getItem('token');\n    api.getLikeMovies(token)\n      .then((data) => {\n        setFilmsSaved(data);\n      })\n      .catch((err) => console.log(err));\n\n    const localStorageSaveFilms = localStorage.getItem('savedResults');\n    const localStorageFilms = localStorage.getItem('films');  \n\n    if (localStorageSaveFilms) {\n      const filterData = JSON.parse(localStorageSaveFilms);\n      const allFindFilms = JSON.parse(localStorageFilms);\n      console.log(filterData);\n      setFilmsShowed(filterData);\n      setFilms(allFindFilms.splice(10));\n      setPreloader(false)\n    }\n    const localStorageFilmsInputSearch = localStorage.getItem('filmsInputSearch');\n    const localStorageFilmsTumbler = localStorage.getItem('filmsTumbler');  \n    if (localStorageFilmsTumbler) {\n      setFilmsTumbler(localStorageFilmsTumbler === 'true');\n     }    \n    if (localStorageFilmsInputSearch) {\n      setFilmsInputSearch(localStorageFilmsInputSearch);\n    }    \n  }, []);\n\n  return (\n    <>\n      <Header />\n      <Navigation />\n      <SearchForm\n        handleGetMovies={handleGetMovies}\n        filmsTumbler={filmsTumbler}\n        filmsInputSearch={filmsInputSearch}\n        handleGetMoviesTumbler={handleGetMoviesTumbler}\n      />\n      {preloader && <Preloader />}\n\n      {!preloader && films !== null && filmsSaved !== null && filmsShowed !== null &&\n\n        <MoviesCardList\n          handleMore={handleMore}\n          filmsRemains={films}\n          films={filmsShowed}\n          savedMoviesToggle={savedMoviesToggle}\n          filmsSaved={filmsSaved}\n        />\n      }\n      <Footer />\n\n\n      <InfoToolTip\n            id=\"reg-pic\"\n            isOpened={isInfoToolTipOpened}\n            onClose={closeAllPopups}\n            isSuccseed={isSuccseed}\n          />\n    </>\n  );\n};"]},"metadata":{},"sourceType":"module"}