{"ast":null,"code":"import _slicedToArray from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import\"./App.css\";import React,{useState,useEffect}from\"react\";import{Routes,Route,useNavigate}from\"react-router-dom\";import*as Auth from\"../../utils/auth\";import{ProtectedRoute}from\"../ProtectedRoute/ProtectedRoute\";import{api}from\"../../utils/api\";import{Register}from\"../Registrer/Register\";import{Login}from\"../Login/Login\";import{ErrorNotFound}from\"../NotFoundError/NotFoundError\";import{Main}from\"../Main/Main\";import{Movies}from\"../Movies/Movies\";import{SavedMovies}from\"../SavedMovies/SavedMovies\";import{Profile}from\"../Profile/Profile\";import{CurrentUserContext}from\"../../context/CurrentUserContext\";import{isLoggedInContext}from\"../../context/IsLoggedInContext\";import{InfoToolTip}from\"../Popup/Popup\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var App=function App(){var navigate=useNavigate();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),loggedIn=_useState2[0],setLoggedIn=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];//поп-ап с подсказкой\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isInfoToolTipOpened=_useState6[0],setIsInfoToolTipOpened=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isSuccseed=_useState8[0],setSuccseed=_useState8[1];//получаю данные пользователя\nuseEffect(function(){var token=localStorage.getItem(\"token\");api.getUserInfo(token).then(function(){setLoggedIn(true);}).catch(function(err){return console.log(err);});},[]);useEffect(function(){var token=localStorage.getItem(\"token\");if(loggedIn){api.getUserInfo(token).then(function(user){setLoggedIn(true);setCurrentUser(user);}).catch(function(err){return console.log(err);});}},[loggedIn]);var handleUpdateUser=function handleUpdateUser(_ref){var name=_ref.name,email=_ref.email;var token=localStorage.getItem('token');api.setUserInfo(name,email,token).then(function(userData){setCurrentUser(userData);setSuccseed(true);closeAllPopups();}).catch(function(error){console.log(error);setSuccseed(false);setIsInfoToolTipOpened(true);});};var onRegister=function onRegister(_ref2){var email=_ref2.email,password=_ref2.password,name=_ref2.name;return Auth.register(email,password,name).then(function(res){if(res){setSuccseed(true);setIsInfoToolTipOpened(true);navigate(\"/movies\");}else{setSuccseed(false);setIsInfoToolTipOpened(true);}});};var onLogin=function onLogin(_ref3){var email=_ref3.email,password=_ref3.password;return Auth.login(email,password).then(function(res){if(res){localStorage.setItem(\"token\",res.token);setLoggedIn(true);navigate(\"/movies\");}else{setLoggedIn(false);setSuccseed(false);setIsInfoToolTipOpened(true);}}).catch(function(err){return console.log(err);});};var onSignOut=function onSignOut(){localStorage.clear();setLoggedIn(false);navigate(\"/\");};var closeAllPopups=function closeAllPopups(){setIsInfoToolTipOpened(false);};return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsx(isLoggedInContext.Provider,{value:loggedIn,children:/*#__PURE__*/_jsxs(\"div\",{className:\"root\",children:[/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(Main,{loggedIn:loggedIn})}),!loggedIn?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",element:/*#__PURE__*/_jsx(Login,{loggedIn:loggedIn,onLogin:onLogin})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",element:/*#__PURE__*/_jsx(Register,{onRegister:onRegister})})]}):null,/*#__PURE__*/_jsxs(Route,{element:/*#__PURE__*/_jsx(ProtectedRoute,{}),children:[/*#__PURE__*/_jsx(Route,{path:\"/movies\",element:/*#__PURE__*/_jsx(Movies,{onClose:closeAllPopups})}),/*#__PURE__*/_jsx(Route,{path:\"/saved-movies\",element:/*#__PURE__*/_jsx(SavedMovies,{})}),/*#__PURE__*/_jsx(Route,{path:\"/profile\",element:/*#__PURE__*/_jsx(Profile,{onUpdateUser:handleUpdateUser,onSignOut:onSignOut})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(ErrorNotFound,{})})]})]}),/*#__PURE__*/_jsx(InfoToolTip,{id:\"reg-pic\",isOpened:isInfoToolTipOpened,onClose:closeAllPopups,isSuccseed:isSuccseed})]})})});};","map":{"version":3,"sources":["/Users/aleksandrmalyh/dev/movies-explorer-frontend/src/components/App/App.js"],"names":["React","useState","useEffect","Routes","Route","useNavigate","Auth","ProtectedRoute","api","Register","Login","ErrorNotFound","Main","Movies","SavedMovies","Profile","CurrentUserContext","isLoggedInContext","InfoToolTip","App","navigate","loggedIn","setLoggedIn","currentUser","setCurrentUser","isInfoToolTipOpened","setIsInfoToolTipOpened","isSuccseed","setSuccseed","token","localStorage","getItem","getUserInfo","then","catch","err","console","log","user","handleUpdateUser","name","email","setUserInfo","userData","closeAllPopups","error","onRegister","password","register","res","onLogin","login","setItem","onSignOut","clear"],"mappings":"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","sourcesContent":["import \"./App.css\";\nimport React, { useState, useEffect } from \"react\";\nimport { Routes, Route, useNavigate } from \"react-router-dom\";\nimport * as Auth from \"../../utils/auth\";\nimport { ProtectedRoute } from \"../ProtectedRoute/ProtectedRoute\";\nimport { api } from \"../../utils/api\";\nimport { Register } from \"../Registrer/Register\";\nimport { Login } from \"../Login/Login\";\nimport { ErrorNotFound } from \"../NotFoundError/NotFoundError\";\nimport { Main } from \"../Main/Main\";\nimport { Movies } from \"../Movies/Movies\";\nimport { SavedMovies } from \"../SavedMovies/SavedMovies\";\nimport { Profile } from \"../Profile/Profile\";\nimport { CurrentUserContext } from \"../../context/CurrentUserContext\";\nimport { isLoggedInContext } from \"../../context/IsLoggedInContext\";\nimport { InfoToolTip } from \"../Popup/Popup\";\n\nexport const App = () => {\n  let navigate = useNavigate();\n\n  const [loggedIn, setLoggedIn] = useState(null);\n  const [currentUser, setCurrentUser] = useState({});\n\n  //поп-ап с подсказкой\n  const [isInfoToolTipOpened, setIsInfoToolTipOpened] = useState(false);\n  const [isSuccseed, setSuccseed] = useState(true);\n\n\n  //получаю данные пользователя\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n\n    api\n      .getUserInfo(token)\n      .then(() => {\n        setLoggedIn(true);\n      })\n      .catch((err) => console.log(err));\n  }, []);\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"token\");\n    if (loggedIn) {\n      api.getUserInfo(token)\n        .then((user) => {\n          setLoggedIn(true)\n          setCurrentUser(user);\n        })\n        .catch((err) => console.log(err));\n    }\n  }, [loggedIn])\n\n\n  const handleUpdateUser = ({ name, email }) => {\n    const token = localStorage.getItem('token');\n    api\n      .setUserInfo(name, email, token)\n      .then((userData) => {\n        setCurrentUser(userData);\n        setSuccseed(true);\n        closeAllPopups();\n      })\n      .catch((error) => {\n        console.log(error);\n        setSuccseed(false);\n        setIsInfoToolTipOpened(true);\n      });\n  };\n\n  const onRegister = ({ email, password, name }) => {\n    return Auth.register(email, password, name).then((res) => {\n      if (res) {\n        setSuccseed(true);\n        setIsInfoToolTipOpened(true);\n        navigate(\"/movies\");\n      } else {\n        setSuccseed(false);\n        setIsInfoToolTipOpened(true);\n      }\n    });\n  };\n\n  const onLogin = ({ email, password }) => {\n    return Auth.login(email, password)\n      .then((res) => {\n        if (res) {\n          localStorage.setItem(\"token\", res.token);\n          setLoggedIn(true);\n          navigate(\"/movies\");\n        } else {\n          setLoggedIn(false);\n          setSuccseed(false);\n          setIsInfoToolTipOpened(true);\n        }\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const onSignOut = () => {\n    localStorage.clear();\n    setLoggedIn(false);\n    navigate(\"/\");\n  };\n\n  const closeAllPopups = () => {\n    setIsInfoToolTipOpened(false);\n  };\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n      <isLoggedInContext.Provider value={loggedIn}>\n        <div className=\"root\">\n          <Routes>\n            <Route path=\"/\" element={<Main loggedIn={loggedIn} />} />\n            {!loggedIn\n              ? (<>\n                <Route path=\"/sign-in\" element={<Login loggedIn={loggedIn} onLogin={onLogin} />} />\n                <Route path=\"/sign-up\" element={<Register onRegister={onRegister} />} />\n              </>)\n              : null\n            }\n            <Route element={<ProtectedRoute />}>\n              <Route path=\"/movies\" element={<Movies onClose={closeAllPopups} />} />\n              <Route path=\"/saved-movies\" element={<SavedMovies />} />\n              <Route path=\"/profile\" element={<Profile onUpdateUser={handleUpdateUser} onSignOut={onSignOut} />}\n              />\n              <Route path=\"*\" element={<ErrorNotFound />} />\n            </Route>\n\n          </Routes>\n\n          <InfoToolTip\n            id=\"reg-pic\"\n            isOpened={isInfoToolTipOpened}\n            onClose={closeAllPopups}\n            isSuccseed={isSuccseed}\n          />\n        </div>\n      </isLoggedInContext.Provider>\n    </CurrentUserContext.Provider>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}