{"ast":null,"code":"import _asyncToGenerator from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/aleksandrmalyh/dev/movies-explorer-frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useEffect,useState}from\"react\";import{Header}from\"../Header/Header\";import{SearchForm}from\"../SearchForm/SearchForm\";import{Navigation}from\"../Navigation/Navigation\";import{MoviesCardList}from\"../MoviesCardList/MoviesCadList\";import{Footer}from\"../Footer/Footer\";import{apiFilm}from\"../../utils/MoviesApi\";import{api}from\"../../utils/api\";import{Preloader}from\"../Preloader/Loader\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Movies=function Movies(){var imageURL='https://api.nomoreparties.co';//all films from server\nvar _useState=useState(null),_useState2=_slicedToArray(_useState,2),films=_useState2[0],setFilms=_useState2[1];//фильмы, которые мы будем отображать!\nvar _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),filmsShowed=_useState4[0],setFilmsShowed=_useState4[1];//залайканные фильмы\nvar _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),filmsSaved=_useState6[0],setFilmsSaved=_useState6[1];//устанавливаем кол-вол карточек для отображения\nvar _useState7=useState(10),_useState8=_slicedToArray(_useState7,2),visible=_useState8[0],setVisible=_useState8[1];//прелоадер\nvar _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),preloader=_useState10[0],setPreloader=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),filmsTumbler=_useState12[0],setFilmsTumbler=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),filmsInputSearch=_useState14[0],setFilmsInputSearch=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),filmsWithTumbler=_useState16[0],setFilmsWithTumbler=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),filmsShowedWithTumbler=_useState18[0],setFilmsShowedWithTumbler=_useState18[1];function handleGetMovies(_x,_x2){return _handleGetMovies.apply(this,arguments);}function _handleGetMovies(){_handleGetMovies=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(inputSearch,tumbler){var token,data,filterData,shortFilms,spliceData,_spliceData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setFilmsTumbler(false);localStorage.setItem('filmsTumbler',false);setPreloader(true);_context.prev=3;token=localStorage.getItem('token');_context.next=7;return apiFilm.getFilmInfo(token);case 7:data=_context.sent;filterData=data.filter(function(_ref){var nameRU=_ref.nameRU;return nameRU.toLowerCase().includes(inputSearch.toLowerCase());});if(tumbler){localStorage.setItem('films',JSON.stringify(filterData));localStorage.setItem('filmsInputSearch',inputSearch);shortFilms=filterData.filter(function(_ref2){var duration=_ref2.duration;return duration<=40;});setFilmsShowed(shortFilms);spliceData=shortFilms.splice(0,visible);setFilmsShowed(spliceData);setFilms(spliceData);setFilmsShowedWithTumbler(spliceData);setFilmsWithTumbler(filterData);}else{localStorage.setItem('films',JSON.stringify(filterData));localStorage.setItem('filmsInputSearch',inputSearch);_spliceData=filterData.splice(0,visible);setFilmsShowed(_spliceData);setFilms(filterData);setFilmsShowedWithTumbler(_spliceData);setFilmsWithTumbler(filterData);}_context.next=18;break;case 12:_context.prev=12;_context.t0=_context[\"catch\"](3);setFilms([]);localStorage.removeItem('films');localStorage.removeItem('filmsTumbler');localStorage.removeItem('filmsInputSearch');case 18:_context.prev=18;setPreloader(false);return _context.finish(18);case 21:case\"end\":return _context.stop();}}},_callee,null,[[3,12,18,21]]);}));return _handleGetMovies.apply(this,arguments);}function handleGetMoviesTumbler(_x3,_x4){return _handleGetMoviesTumbler.apply(this,arguments);}// добавляем количество фильмов при нажатии на кнопку\nfunction _handleGetMoviesTumbler(){_handleGetMoviesTumbler=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(keyword,tumbler){var filterDataShowed,filterData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:console.log(tumbler);filterDataShowed=[];filterData=[];if(tumbler){setFilmsShowedWithTumbler(filmsShowed);setFilmsWithTumbler(films);filterDataShowed=filmsShowed.filter(function(_ref3){var duration=_ref3.duration;return duration<=40;});filterData=films.filter(function(_ref4){var duration=_ref4.duration;return duration<=40;});handleGetMovies(keyword,tumbler);}else{filterDataShowed=filmsShowedWithTumbler;filterData=filmsWithTumbler;handleGetMovies(keyword,tumbler);}localStorage.setItem('films',JSON.stringify(filterDataShowed.concat(filterData)));localStorage.setItem('filmsTumbler',tumbler);setFilmsShowed(filterDataShowed);setFilms(filterData);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return _handleGetMoviesTumbler.apply(this,arguments);}var handleMore=function handleMore(){var newFilmsShowed=filmsShowed.concat(films.splice(0,visible));//10 фильмов, которые сейчас отображатся\nsetFilmsShowed(newFilmsShowed);};function savedMoviesToggle(_x5,_x6){return _savedMoviesToggle.apply(this,arguments);}//монтируем \nfunction _savedMoviesToggle(){_savedMoviesToggle=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(movie,fav){var token,savedMovie,newSaved,_token,_newSaved;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!fav){_context3.next=17;break;}// console.log('film', film)\ntoken=localStorage.getItem('token');savedMovie={country:movie.country||'none',director:movie.director||'none',duration:movie.duration,year:movie.year,description:movie.description||'none',nameRU:movie.nameRU,nameEN:movie.nameEN,image:\"\".concat(imageURL).concat(movie.image.url)||'https://www.youtube.com/',trailer:movie.trailerLink||'https://www.youtube.com',thumbnail:\"\".concat(imageURL).concat(movie.image.url)||'https://www.youtube.com/',movieId:movie.id};_context3.prev=3;_context3.next=6;return api.addNewCard(savedMovie,token);case 6:_context3.next=8;return api.getLikeMovies(token);case 8:newSaved=_context3.sent;setFilmsSaved(newSaved);_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](3);console.log(_context3.t0);case 15:_context3.next=30;break;case 17:_context3.prev=17;_token=localStorage.getItem('token');_context3.next=21;return api.removeNewCard(movie._id,_token);case 21:_context3.next=23;return api.getLikeMovies(_token);case 23:_newSaved=_context3.sent;setFilmsSaved(_newSaved);_context3.next=30;break;case 27:_context3.prev=27;_context3.t1=_context3[\"catch\"](17);console.log(_context3.t1);case 30:case\"end\":return _context3.stop();}}},_callee3,null,[[3,12],[17,27]]);}));return _savedMoviesToggle.apply(this,arguments);}useEffect(function(){//фильмы с сервака\nvar token=localStorage.getItem('token');api.getLikeMovies(token).then(function(data){setFilmsSaved(data);}).catch(function(err){return console.log(err);});var localStorageFilms=localStorage.getItem('films');if(localStorageFilms){var filterData=JSON.parse(localStorageFilms);setFilmsShowed(filterData.splice(0,visible));setFilms(filterData);setPreloader(false);}var localStorageFilmsInputSearch=localStorage.getItem('filmsInputSearch');if(localStorageFilmsInputSearch){setFilmsInputSearch(localStorageFilmsInputSearch);}},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Header,{}),/*#__PURE__*/_jsx(Navigation,{}),/*#__PURE__*/_jsx(SearchForm,{handleGetMovies:handleGetMovies,filmsTumbler:filmsTumbler,filmsInputSearch:filmsInputSearch,handleGetMoviesTumbler:handleGetMoviesTumbler}),preloader&&/*#__PURE__*/_jsx(Preloader,{}),!preloader&&films!==null&&filmsSaved!==null&&filmsShowed!==null&&/*#__PURE__*/_jsx(MoviesCardList,{handleMore:handleMore,filmsRemains:films,films:filmsShowed,savedMoviesToggle:savedMoviesToggle,filmsSaved:filmsSaved}),/*#__PURE__*/_jsx(Footer,{})]});};","map":{"version":3,"sources":["/Users/aleksandrmalyh/dev/movies-explorer-frontend/src/components/Movies/Movies.js"],"names":["React","useEffect","useState","Header","SearchForm","Navigation","MoviesCardList","Footer","apiFilm","api","Preloader","Movies","imageURL","films","setFilms","filmsShowed","setFilmsShowed","filmsSaved","setFilmsSaved","visible","setVisible","preloader","setPreloader","filmsTumbler","setFilmsTumbler","filmsInputSearch","setFilmsInputSearch","filmsWithTumbler","setFilmsWithTumbler","filmsShowedWithTumbler","setFilmsShowedWithTumbler","handleGetMovies","inputSearch","tumbler","localStorage","setItem","token","getItem","getFilmInfo","data","filterData","filter","nameRU","toLowerCase","includes","JSON","stringify","shortFilms","duration","spliceData","splice","removeItem","handleGetMoviesTumbler","keyword","console","log","filterDataShowed","concat","handleMore","newFilmsShowed","savedMoviesToggle","movie","fav","savedMovie","country","director","year","description","nameEN","image","url","trailer","trailerLink","thumbnail","movieId","id","addNewCard","getLikeMovies","newSaved","removeNewCard","_id","then","catch","err","localStorageFilms","parse","localStorageFilmsInputSearch"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport { Header } from \"../Header/Header\";\nimport { SearchForm } from \"../SearchForm/SearchForm\";\nimport { Navigation } from \"../Navigation/Navigation\";\nimport { MoviesCardList } from \"../MoviesCardList/MoviesCadList\";\nimport { Footer } from \"../Footer/Footer\";\nimport { apiFilm } from \"../../utils/MoviesApi\";\nimport { api } from \"../../utils/api\";\nimport { Preloader } from \"../Preloader/Loader\";\n\nexport const Movies = () => {\n\n  const imageURL = 'https://api.nomoreparties.co';\n\n  //all films from server\n  const [films, setFilms] = useState(null)\n  //фильмы, которые мы будем отображать!\n  const [filmsShowed, setFilmsShowed] = useState(null);\n  //залайканные фильмы\n  const [filmsSaved, setFilmsSaved] = useState(null);\n\n  //устанавливаем кол-вол карточек для отображения\n  const [visible, setVisible] = useState(10);\n\n  //прелоадер\n  const [preloader, setPreloader] = useState(false);\n\n\n  const [filmsTumbler, setFilmsTumbler] = useState(false);\n  const [filmsInputSearch, setFilmsInputSearch] = useState('');\n\n\n  const [filmsWithTumbler, setFilmsWithTumbler] = useState([]);\n  const [filmsShowedWithTumbler, setFilmsShowedWithTumbler] = useState([]);\n\n\n  async function handleGetMovies(inputSearch, tumbler) {\n    setFilmsTumbler(false)\n    localStorage.setItem('filmsTumbler', false);\n    setPreloader(true);\n    try {\n      const token = localStorage.getItem('token')\n      const data = await apiFilm.getFilmInfo(token);\n      let filterData = data.filter(({ nameRU }) => nameRU.toLowerCase().includes(inputSearch.toLowerCase()));\n      if (tumbler) {\n        localStorage.setItem('films', JSON.stringify(filterData)); \n        localStorage.setItem('filmsInputSearch', inputSearch); \n        const shortFilms = filterData.filter(({ duration }) => duration <= 40);\n        setFilmsShowed(shortFilms);\n        const spliceData = shortFilms.splice(0, visible);\n\n        setFilmsShowed(spliceData);\n        setFilms(spliceData);\n\n        setFilmsShowedWithTumbler(spliceData);\n        setFilmsWithTumbler(filterData);\n\n      }\n      else {\n        localStorage.setItem('films', JSON.stringify(filterData)); \n        localStorage.setItem('filmsInputSearch', inputSearch);\n        const spliceData = filterData.splice(0, visible);\n        setFilmsShowed(spliceData);\n        setFilms(filterData);\n\n        setFilmsShowedWithTumbler(spliceData);\n        setFilmsWithTumbler(filterData);\n      }\n    } catch (err) {\n      setFilms([]);\n      localStorage.removeItem('films');\n      localStorage.removeItem('filmsTumbler');\n      localStorage.removeItem('filmsInputSearch');\n    } finally {\n      setPreloader(false)\n    }\n  }\n\n\n  async function handleGetMoviesTumbler(keyword, tumbler) {\n    console.log(tumbler);\n    let filterDataShowed = [];\n    let filterData = [];\n    if (tumbler) {\n      setFilmsShowedWithTumbler(filmsShowed);\n      setFilmsWithTumbler(films);\n\n      filterDataShowed = filmsShowed.filter(({ duration }) => duration <= 40);\n      filterData = films.filter(({ duration }) => duration <= 40);\n      handleGetMovies(keyword, tumbler)\n    } else {\n      filterDataShowed = filmsShowedWithTumbler;\n      filterData = filmsWithTumbler;\n      handleGetMovies(keyword, tumbler)\n    }\n\n    localStorage.setItem('films', JSON.stringify(filterDataShowed.concat(filterData)));\n    localStorage.setItem('filmsTumbler', tumbler); \n\n    setFilmsShowed(filterDataShowed);\n    setFilms(filterData)\n  }\n\n  // добавляем количество фильмов при нажатии на кнопку\n  const handleMore = () => {\n    const newFilmsShowed = filmsShowed.concat(films.splice(0, visible));\n    //10 фильмов, которые сейчас отображатся\n    setFilmsShowed(newFilmsShowed);\n  }\n\n  async function savedMoviesToggle(movie, fav) {\n    if (fav) {\n      // console.log('film', film)\n      const token = localStorage.getItem('token')\n      const savedMovie = {\n        country: movie.country || 'none',\n        director: movie.director || 'none',\n        duration: movie.duration,\n        year: movie.year,\n        description: movie.description || 'none',\n        nameRU: movie.nameRU,\n        nameEN: movie.nameEN,\n        image: `${imageURL}${movie.image.url}` || 'https://www.youtube.com/',\n        trailer: movie.trailerLink || 'https://www.youtube.com',\n        thumbnail: `${imageURL}${movie.image.url}` || 'https://www.youtube.com/',\n        movieId: movie.id,\n      }\n      try {\n        await api.addNewCard(savedMovie, token);\n        const newSaved = await api.getLikeMovies(token);\n        setFilmsSaved(newSaved);\n      } catch (error) {\n        console.log(error);\n      }\n    } else {\n      try {\n        const token = localStorage.getItem('token')\n        await api.removeNewCard(movie._id, token);\n        const newSaved = await api.getLikeMovies(token);\n        setFilmsSaved(newSaved);\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }\n\n  //монтируем \n  useEffect(() => {\n    //фильмы с сервака\n    const token = localStorage.getItem('token');\n    api.getLikeMovies(token)\n      .then((data) => {\n        setFilmsSaved(data);\n      })\n      .catch((err) => console.log(err));\n\n    const localStorageFilms = localStorage.getItem('films');\n    if (localStorageFilms) {\n      const filterData = JSON.parse(localStorageFilms);\n      setFilmsShowed(filterData.splice(0, visible));\n      setFilms(filterData);\n      setPreloader(false)\n    }\n    const localStorageFilmsInputSearch = localStorage.getItem('filmsInputSearch');\n    if (localStorageFilmsInputSearch) {\n      setFilmsInputSearch(localStorageFilmsInputSearch);\n    }\n  }, []);\n\n  return (\n    <>\n      <Header />\n      <Navigation />\n      <SearchForm\n        handleGetMovies={handleGetMovies}\n        filmsTumbler={filmsTumbler}\n        filmsInputSearch={filmsInputSearch}\n        handleGetMoviesTumbler={handleGetMoviesTumbler}\n      />\n      {preloader && <Preloader />}\n\n      {!preloader && films !== null && filmsSaved !== null && filmsShowed !== null &&\n\n        <MoviesCardList\n          handleMore={handleMore}\n          filmsRemains={films}\n          films={filmsShowed}\n          savedMoviesToggle={savedMoviesToggle}\n          filmsSaved={filmsSaved}\n        />\n      }\n      <Footer />\n    </>\n  );\n};"]},"metadata":{},"sourceType":"module"}